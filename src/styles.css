@tailwind base;
@tailwind components;
@tailwind utilities;

/* Custom Milkdown overrides to make it look like Typora */
.milkdown .ProseMirror {
    outline: none;
    min-height: 100vh;
    padding: 2rem;
    max-width: 800px;
    margin: 0 auto;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #2e3440; /* Nord dark grey text for visibility on light bg */
    background-color: white;
}

/* Fix visibility of headings and other elements if Nord makes them light */
.milkdown h1, .milkdown h2, .milkdown h3, .milkdown h4, .milkdown p, .milkdown li, .milkdown span {
   color: inherit !important;
}

/* Vim Mode Command Panel - Bottom Bar Style */
.cm-vim-panel {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #f8fafc; /* bg-slate-50 */
    border-top: 1px solid #e2e8f0;
    padding: 4px 12px;
    z-index: 100;
    font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
    display: flex;
    align-items: center;
    color: #334155;
    font-size: 13px;
    min-height: 32px;
}

.cm-vim-panel input {
    flex: 1;
    border: none;
    outline: none;
    background: transparent;
    margin-left: 8px;
    color: #1e293b;
    font-family: inherit;
    font-size: inherit;
}

/* --- Live Preview Logic for CodeMirror --- */

/* 1. Base Container */
.preview-mode-cm .cm-content {
    font-family: 'Segoe UI', system-ui, sans-serif;
    line-height: 1.6;
    color: #374151; /* gray-700 */
    padding-bottom: 30vh; /* Allow scrolling past end */
}

/* 2. INACTIVE Lines (The 'Preview' Look) */

/* Headings: Make them look like headings */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-h1 { font-size: 2.25em; font-weight: 700; line-height: 1.2; padding-top: 0.5em; padding-bottom: 0.3em; display: inline-block; width: 100%; color: #111827; }
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-h2 { font-size: 1.75em; font-weight: 700; line-height: 1.3; padding-top: 0.5em; padding-bottom: 0.3em; display: inline-block; width: 100%; color: #1f2937; border-bottom: 1px solid #e5e7eb; }
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-h3 { font-size: 1.5em;  font-weight: 600; line-height: 1.4; padding-top: 0.5em; margin-bottom: 0.2em; display: inline-block; width: 100%; color: #374151; }
/* ... add h4-h6 if needed ... */

/* Formatting */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-bold { font-weight: 700; color: #111827; }
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-italic { font-style: italic; }
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-link { color: #2563eb; text-decoration: underline; text-underline-offset: 2px; }
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-code { font-family: 'Menlo', monospace; background-color: #f3f4f6; padding: 0.1rem 0.3rem; border-radius: 0.25rem; color: #db2777; font-size: 0.9em; }

/* HIDING Syntax Markers on Inactive Lines */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-mark {
    display: none;
}
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-url {
    font-size: 0; /* Hide URL part of link */
}

/* LIST HANDLING: The "Ghost" Method */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-list {
    /* 1. Make text invisible but keep layout flow */
    color: transparent !important;

    /* 2. Position control */
    position: relative;
    display: inline-block;
    width: 20px; /* Fixed space for bullet */
    margin: 0; padding: 0;

    /* 3. Ensure no inner text overrides invisibility */
    visibility: hidden;
}

/* Paint the bullet on the pseudo-element, forcing visibility */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-list::after {
    visibility: visible;
    content: "â€¢";

    /* Absolute overlay on the "Ghost" box */
    position: absolute;
    left: 0; top: 0;
    width: 100%; height: 100%;

    /* Styling */
    color: #4b5563; /* gray-600 */
    font-size: 1.2em;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* QUOTE HANDLING: The "Ghost" Method */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-quote {
    color: transparent !important;
    visibility: hidden;

    position: relative;
    display: inline-block;
    width: 4px; /* Bar width */
    margin-right: 12px; /* Gap */

    /* Maintain height logic */
    line-height: inherit;
    font-size: inherit;
}

.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-quote::after {
    visibility: visible;
    content: ""; /* No text */

    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 4px;

    background-color: #cbd5e1; /* slate-300 */
    border-radius: 2px;
}



/* TABLE BORDERS: Visible */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-table-border {
    color: #cbd5e1;
    font-weight: bold;
    display: inline;
}

/* HORIZONTAL RULE: Visible Divider */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-hr {
    color: transparent;
    border-bottom: 2px solid #e2e8f0;
    display: block;
    margin: 1em 0;
}

/* STRIKETHROUGH: Rendered style */
.preview-mode-cm .cm-line:not(.cm-activeLine) .cm-md-strike {
    text-decoration: line-through;
    color: #94a3b8;
}

*/
.preview-mode-cm .cm-activeLine {
    background-color: transparent !important; /* Remove default active line bg if desired, or keep generic one */
    font-family: 'Menlo', 'Consolas', monospace; /* Switch to monospace for editing */
    font-size: 14px;
    line-height: 1.5;
    color: #0f172a;
}

/* Explicitly make markers visible and gray in active line */
.preview-mode-cm .cm-activeLine .cm-md-mark {
    display: inline;
    color: #94a3b8; /* gray-400 */
}
.preview-mode-cm .cm-activeLine .cm-md-h1,
.preview-mode-cm .cm-activeLine .cm-md-h2,
.preview-mode-cm .cm-activeLine .cm-md-h3 {
    font-size: inherit;
    font-weight: bold;
    color: #334155;
    padding: 0;
    border: none;
    width: auto;
}

/* --- Editor Layout & Sizing --- */
/* Ensure the editor feels like a full page text area */
.cm-editor {
    outline: none !important;
}

/* Allow clicking anywhere in the bottom of the editor to focus */
.cm-scroller {
    min-height: calc(100vh - 150px) !important;
    padding-bottom: 30vh !important; /* Overscroll area */
    cursor: text;
}
.cm-content {
    min-height: 100%;
}

/* --- Beautiful Line Numbers --- */
.cm-gutters {
    background-color: transparent !important;
    border-right: none !important;
    color: #cbd5e1 !important; /* text-slate-300 - Subtle color */
    font-family: 'JetBrains Mono', 'Fira Code', 'Menlo', monospace; /* Monospace font */
    font-size: 13px;
    min-width: 40px; /* Minimal width for single digit numbers */
}

/* Individual line number items */
.cm-lineNumbers .cm-gutterElement {
    padding-right: 16px !important; /* Spacing between number and code */
    padding-left: 8px !important;
    text-align: right !important;
    transition: color 0.2s ease;
}

/* Highlight the number of the active line - DISTINCT "EDITING" STATE */
.cm-lineNumbers .cm-activeLineGutter {
    background-color: transparent !important;
    color: #0f172a !important; /* slate-900 - Strict dark color for sharp focus */
    font-weight: 600;
    transform: scale(1.05); /* Subtle pop */
    transform-origin: right center;
}

/* When hovering over the gutter, use a different color to indicate interactivity */
.cm-gutters:hover .cm-gutterElement {
    color: #94a3b8 !important; /* text-slate-400 */
}
.cm-gutters:hover .cm-gutterElement.cm-activeLineGutter {
    color: #0f172a !important; /* Keep active line dark even on hover */
}
